extends ./layout

block content

  h1= id

  ul#user-list

  script(type='text/javascript' src='/socket.io/socket.io.js')
  script(type='text/javascript' data-name=name data-session-id=id id='main').
    (function() {
      var socket = io();
      var name = $('#main').data('name');
      var id = $('#main').data('session-id');
      socket.emit('join', {name: name, id: id});
      socket.on('joined', function (data) {
        user = data
        console.log(user);
        $('#user-list').append('<li id=\"' + user.name + '\">' + user.name + '</li>');
      });

      socket.on('disconnect', function () {});

      socket.on('list-user', function (data) {
        console.log(data.users);
        data.users.forEach(function (user, index, arr) {
          $('#user-list').append('<li id=\"' + user.name + '\">' + user.name + '</li>');
        });
      });

      socket.on('removed', function (data) {
        user = data
        console.log(user);
        $('#user-list #' + user.name).remove();
      });
    }).call(this);
